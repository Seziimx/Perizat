{% extends "base.html" %}

{% block title %}–ï—Å–µ–ø—Ç–µ—Ä{% endblock %}

{% block content %}
<div class="card">
    <h1 class="text-center mb-4">–ï—Å–µ–ø—Ç–µ—Ä</h1>

    <!-- Summary Section -->
    <div class="row mb-4">
        <div class="col-md-4">
            <div class="text-white bg-primary p-3 rounded">
                <h5>–ë–∞—Ä–ª—ã“õ –∂–∞–±–¥—ã“õ—Ç–∞—Ä</h5>
                <p class="fs-4">{{ equipment_list|length }}</p>
            </div>
        </div>
        <div class="col-md-4">
            <div class="text-white bg-success p-3 rounded">
                <h5>–ü–∞–π–¥–∞–ª–∞–Ω—É–¥–∞</h5>
                <p class="fs-4">{{ equipment_list|selectattr('status', 'equalto', '–ü–∞–π–¥–∞–ª–∞–Ω—É–¥–∞')|list|length }}</p>
            </div>
        </div>
        <div class="col-md-4">
            <div class="text-white bg-danger p-3 rounded">
                <h5>–ñ”©–Ω–¥–µ—É–¥–µ</h5>
                <p class="fs-4">{{ equipment_list|selectattr('status', 'equalto', '–ñ”©–Ω–¥–µ—É–¥–µ')|list|length }}</p>
            </div>
        </div>
    </div>

    <!-- Export Button -->
    <div class="text-end mb-3">
        <a href="{{ url_for('report_bp.export_word') }}" class="btn btn-success">Word-–∫–µ —ç–∫—Å–ø–æ—Ä—Ç—Ç–∞—É (—Å“Ø–∑—ñ–ª–≥–µ–Ω)</a>
        <a href="{{ url_for('report_bp.export_full_word') }}" class="btn btn-secondary">–¢–æ–ª—ã“õ –µ—Å–µ–ø—Ç—ñ –∂“Ø–∫—Ç–µ—É</a>
    </div>

    <!-- Filters -->
    <form method="GET" action="{{ url_for('report_bp.reports_page') }}" class="mb-4">
        <div class="row">
            <div class="col-md-4">
                <label for="type" class="form-label">–ñ–∞–±–¥—ã“õ —Ç“Ø—Ä—ñ:</label>
                <select id="type" name="type" class="form-select">
                    <option value="" disabled selected>–ñ–∞–±–¥—ã“õ —Ç“Ø—Ä—ñ–Ω —Ç–∞“£–¥–∞“£—ã–∑</option>
                    <option value="–ë“±—Ä“ì—ã–ª–∞—É –∂–∞–±–¥—ã“ì—ã">üèóÔ∏è –ë“±—Ä“ì—ã–ª–∞—É –∂–∞–±–¥—ã“ì—ã</option>
                    <option value="”®–Ω–¥—ñ—Ä—É –∂–∞–±–¥—ã“ì—ã">üíß ”®–Ω–¥—ñ—Ä—É –∂–∞–±–¥—ã“ì—ã</option>
                    <option value="“∞“£“ì—ã–º–∞ —Å–∞“ì–∞—Å—ã–Ω—ã“£ –∂–∞–±–¥—ã“ì—ã">üî© “∞“£“ì—ã–º–∞ —Å–∞“ì–∞—Å—ã–Ω—ã“£ –∂–∞–±–¥—ã“ì—ã</option>
                    <option value="–¶–∏—Ä–∫—É–ª—è—Ü–∏—è –∂”ô–Ω–µ –∞–π–¥–∞—É">üîÅ –¶–∏—Ä–∫—É–ª—è—Ü–∏—è –∂”ô–Ω–µ –∞–π–¥–∞—É</option>
                    <option value="–≠–ª–µ–∫—Ç—Ä –∂–∞–±–¥—ã“ì—ã">üîå –≠–ª–µ–∫—Ç—Ä –∂–∞–±–¥—ã“ì—ã</option>
                    <option value="–°—ã–π—ã–º–¥—ã–ª—ã“õ –∂–∞–±–¥—ã“ì—ã">üõ¢Ô∏è –°—ã–π—ã–º–¥—ã–ª—ã“õ –∂–∞–±–¥—ã“ì—ã</option>
                    <option value="–¢–µ—Ö–Ω–æ–ª–æ–≥–∏—è–ª—ã“õ –±–ª–æ–∫—Ç–∞—Ä">üîß –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—è–ª—ã“õ –±–ª–æ–∫—Ç–∞—Ä</option>
                    <option value="–ö”©–º–µ–∫—à—ñ –∂–∞–±–¥—ã“õ">üöú –ö”©–º–µ–∫—à—ñ –∂–∞–±–¥—ã“õ</option>
                </select>
            </div>
            <div class="col-md-4">
                <label for="location" class="form-label">–û—Ä–Ω–∞–ª–∞—Å—É—ã –±–æ–π—ã–Ω—à–∞ —Å“Ø–∑–≥—ñ:</label>
                <input type="text" id="location" name="location" class="form-control" value="{{ request.args.get('location', '') }}">
            </div>
            <div class="col-md-3">
                <label for="date_from" class="form-label">–ö“Ø–Ω—ñ –±–∞—Å—Ç–∞–ø:</label>
                <input type="date" id="date_from" name="date_from" class="form-control" value="{{ request.args.get('date_from', '') }}">
            </div>
            <div class="col-md-3">
                <label for="date_to" class="form-label">–ö“Ø–Ω—ñ –¥–µ–π—ñ–Ω:</label>
                <input type="date" id="date_to" name="date_to" class="form-control" value="{{ request.args.get('date_to', '') }}">
            </div>
            <div class="col-md-2 d-flex align-items-end">
                <button class="btn btn-primary w-100" type="submit">–°“Ø–∑–≥—ñ–Ω—ñ “õ–æ–ª–¥–∞–Ω—É</button>
            </div>
        </div>
    </form>

    <!-- Filtered Equipment Table -->
    <h2>–°“Ø–∑—ñ–ª–≥–µ–Ω –∂–∞–±–¥—ã“õ—Ç–∞—Ä —Ç—ñ–∑—ñ–º—ñ</h2>
    <div class="table-responsive">
        <table class="table table-striped">
            <thead>
                <tr>
                    <th>–ê—Ç–∞—É—ã</th>
                    <th>–¢“Ø—Ä—ñ</th>
                    <th>–ú”ô—Ä—Ç–µ–±–µ—Å—ñ</th>
                    <th>–û—Ä–Ω–∞–ª–∞—Å—É—ã</th>
                    <th>–§–∞–π–ª–¥–∞—Ä</th>
                    <th>–¢–∞—Ä–∏—Ö—ã</th>
                </tr>
            </thead>
            <tbody>
                {% if equipment_list %}
                {% for equipment in equipment_list %}
                <tr>
                    <td>{{ equipment.name }}</td>
                    <td>{{ equipment.type }}</td>
                    <td>
                        {% if equipment.status == '–ü–∞–π–¥–∞–ª–∞–Ω—É–¥–∞' %}
                        üü¢ –ü–∞–π–¥–∞–ª–∞–Ω—É–¥–∞
                        {% elif equipment.status == '–ñ”©–Ω–¥–µ—É–¥–µ' %}
                        üî¥ –ñ”©–Ω–¥–µ—É–¥–µ
                        {% elif equipment.status == '–¢—ñ–∑—ñ–º–Ω–µ–Ω —à—ã“ì–∞—Ä—ã–ª“ì–∞–Ω' %}
                        ‚ö™ –¢—ñ–∑—ñ–º–Ω–µ–Ω —à—ã“ì–∞—Ä—ã–ª“ì–∞–Ω
                        {% endif %}
                    </td>
                    <td>{{ equipment.location }}</td>
                    <td>
                        {% if equipment.files %}
                        <ul class="list-unstyled">
                            {% for file in equipment.files %}
                            <li>
                                <a href="{{ url_for('static', filename='uploads/' ~ file) }}" target="_blank" class="badge bg-secondary">{{ file }}</a>
                            </li>
                            {% endfor %}
                        </ul>
                        {% else %}
                        <span class="text-muted">–§–∞–π–ª–¥–∞—Ä –∂–æ“õ</span>
                        {% endif %}
                    </td>
                    <td>
                        <button class="btn btn-link" type="button" data-bs-toggle="collapse" data-bs-target="#logs-{{ equipment.id }}" aria-expanded="false" aria-controls="logs-{{ equipment.id }}">
                            –¢–∞—Ä–∏—Ö—Ç—ã –∫”©—Ä—Å–µ—Ç—É
                        </button>
                        <div class="collapse" id="logs-{{ equipment.id }}">
                            <ul class="mt-2">
                                {% for log in equipment.logs %}
                                <li>{{ log.timestamp }}: {{ log.event }}</li>
                                {% endfor %}
                            </ul>
                        </div>
                    </td>
                </tr>
                {% endfor %}
                {% else %}
                <tr>
                    <td colspan="6" class="text-center">–ö”©—Ä—Å–µ—Ç—ñ–ª–µ—Ç—ñ–Ω –¥–µ—Ä–µ–∫—Ç–µ—Ä –∂–æ“õ</td>
                </tr>
                {% endif %}
            </tbody>
        </table>
    </div>
</div>
{% endblock %}
