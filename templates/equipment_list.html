{% extends "base.html" %}

{% block title %}–ñ–∞–±–¥—ã“õ—Ç–∞—Ä —Ç—ñ–∑—ñ–º—ñ{% endblock %}

{% block content %}
<div class="card">
    <h1 class="text-center">–ñ–∞–±–¥—ã“õ—Ç–∞—Ä —Ç—ñ–∑—ñ–º—ñ</h1>

    <!-- Summary Section -->
    <div class="row mb-4">
        <div class="col-md-4">
            <div class="card text-white bg-primary mb-3">
                <div class="card-body">
                    <h5 class="card-title">–ë–∞—Ä–ª—ã“õ –∂–∞–±–¥—ã“õ—Ç–∞—Ä</h5>
                    <p class="card-text">{{ equipment_list|length }}</p>
                </div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="card text-white bg-success mb-3">
                <div class="card-body">
                    <h5 class="card-title">–ü–∞–π–¥–∞–ª–∞–Ω—É–¥–∞</h5>
                    <p class="card-text">{{ equipment_list|selectattr('status', 'equalto', '–ü–∞–π–¥–∞–ª–∞–Ω—É–¥–∞')|list|length }}</p>
                </div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="card text-white bg-danger mb-3">
                <div class="card-body">
                    <h5 class="card-title">–ñ”©–Ω–¥–µ—É–¥–µ</h5>
                    <p class="card-text">{{ equipment_list|selectattr('status', 'equalto', '–ñ”©–Ω–¥–µ—É–¥–µ')|list|length }}</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Filters -->
    <form method="GET" action="{{ url_for('equipment_bp.equipment_list') }}" class="mb-4">
        <div class="row">
            <div class="col-md-4">
                <label for="type" class="form-label">–¢“Ø—Ä—ñ:</label>
                <select id="type" name="type" class="form-select">
                    <option value="">–ë–∞—Ä–ª—ã“ì—ã</option>
                    <option value="–ë“±—Ä“ì—ã–ª–∞—É –∂–∞–±–¥—ã“ì—ã">üèóÔ∏è –ë“±—Ä“ì—ã–ª–∞—É –∂–∞–±–¥—ã“ì—ã</option>
                    <option value="”®–Ω–¥—ñ—Ä—É –∂–∞–±–¥—ã“ì—ã">üíß ”®–Ω–¥—ñ—Ä—É –∂–∞–±–¥—ã“ì—ã</option>
                    <option value="“∞“£“ì—ã–º–∞ —Å–∞“ì–∞—Å—ã–Ω—ã“£ –∂–∞–±–¥—ã“ì—ã">üî© “∞“£“ì—ã–º–∞ —Å–∞“ì–∞—Å—ã–Ω—ã“£ –∂–∞–±–¥—ã“ì—ã</option>
                    <option value="–¶–∏—Ä–∫—É–ª—è—Ü–∏—è –∂”ô–Ω–µ –∞–π–¥–∞—É">üîÅ –¶–∏—Ä–∫—É–ª—è—Ü–∏—è –∂”ô–Ω–µ –∞–π–¥–∞—É</option>
                    <option value="–≠–ª–µ–∫—Ç—Ä –∂–∞–±–¥—ã“ì—ã">üîå –≠–ª–µ–∫—Ç—Ä –∂–∞–±–¥—ã“ì—ã</option>
                    <option value="–°—ã–π—ã–º–¥—ã–ª—ã“õ –∂–∞–±–¥—ã“ì—ã">üõ¢Ô∏è –°—ã–π—ã–º–¥—ã–ª—ã“õ –∂–∞–±–¥—ã“ì—ã</option>
                    <option value="–¢–µ—Ö–Ω–æ–ª–æ–≥–∏—è–ª—ã“õ –±–ª–æ–∫—Ç–∞—Ä">üîß –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—è–ª—ã“õ –±–ª–æ–∫—Ç–∞—Ä</option>
                    <option value="–ö”©–º–µ–∫—à—ñ –∂–∞–±–¥—ã“õ">üöú –ö”©–º–µ–∫—à—ñ –∂–∞–±–¥—ã“õ</option>
                </select>
            </div>
            <div class="col-md-4">
                <label for="location" class="form-label">–û—Ä–Ω–∞–ª–∞—Å—É—ã:</label>
                <select id="location" name="location" class="form-select">
                    <option value="">–ë–∞—Ä–ª—ã“ì—ã</option>
                    {% for location in locations %}
                    <option value="{{ location }}">{{ location }}</option>
                    {% endfor %}
                </select>
            </div>
            <div class="col-md-4">
                <label for="status" class="form-label">–ú”ô—Ä—Ç–µ–±–µ—Å—ñ:</label>
                <select id="status" name="status" class="form-select">
                    <option value="">–ë–∞—Ä–ª—ã“ì—ã</option>
                    <option value="–ü–∞–π–¥–∞–ª–∞–Ω—É–¥–∞">–ü–∞–π–¥–∞–ª–∞–Ω—É–¥–∞</option>
                    <option value="–ñ”©–Ω–¥–µ—É–¥–µ">–ñ”©–Ω–¥–µ—É–¥–µ</option>
                    <option value="–¢—ñ–∑—ñ–º–Ω–µ–Ω —à—ã“ì–∞—Ä—ã–ª“ì–∞–Ω">–¢—ñ–∑—ñ–º–Ω–µ–Ω —à—ã“ì–∞—Ä—ã–ª“ì–∞–Ω</option>
                </select>
            </div>
        </div>
        <button class="btn btn-primary w-100" type="submit">–°“Ø–∑–≥—ñ–Ω—ñ “õ–æ–ª–¥–∞–Ω—É</button>
    </form>

    <!-- Equipment Table -->
    <div class="table-responsive">
        <table class="table table-striped">
            <thead>
                <tr>
                    <th>–ê—Ç–∞—É—ã</th>
                    <th>–¢“Ø—Ä—ñ</th>
                    <th>–ú”ô—Ä—Ç–µ–±–µ—Å—ñ</th>
                    <th>–û—Ä–Ω–∞–ª–∞—Å—É—ã</th>
                    <th>–¢“Ø–≥–µ–Ω–¥–µ—É –Ω”©–º—ñ—Ä—ñ</th>
                    <th>–Ü—Å–∫–µ “õ–æ—Å—É –∫“Ø–Ω—ñ</th>
                    <th>–§–∞–π–ª–¥–∞—Ä</th>
                    <th>QR –ö–æ–¥</th>
                    <th>”ò—Ä–µ–∫–µ—Ç—Ç–µ—Ä</th>
                </tr>
            </thead>
            <tbody>
                {% for equipment in equipment_list %}
                <tr>
                    <td>{{ equipment.name }}</td>
                    <td>{{ equipment.type }}</td>
                    <td>
                        {% if session['role'] == 'admin' %}
                        <form method="POST" action="{{ url_for('equipment_bp.update_status', id=equipment.id) }}" class="d-inline">
                            <select name="status" class="form-select form-select-sm status-dropdown" onchange="this.form.submit()">
                                <option value="–ü–∞–π–¥–∞–ª–∞–Ω—É–¥–∞" {% if equipment.status == '–ü–∞–π–¥–∞–ª–∞–Ω—É–¥–∞' %}selected{% endif %}>üü¢ –ü–∞–π–¥–∞–ª–∞–Ω—É–¥–∞</option>
                                <option value="–ñ”©–Ω–¥–µ—É–¥–µ" {% if equipment.status == '–ñ”©–Ω–¥–µ—É–¥–µ' %}selected{% endif %}>üî¥ –ñ”©–Ω–¥–µ—É–¥–µ</option>
                                <option value="–¢—ñ–∑—ñ–º–Ω–µ–Ω —à—ã“ì–∞—Ä—ã–ª“ì–∞–Ω" {% if equipment.status == '–¢—ñ–∑—ñ–º–Ω–µ–Ω —à—ã“ì–∞—Ä—ã–ª“ì–∞–Ω' %}selected{% endif %}>‚ö™ –¢—ñ–∑—ñ–º–Ω–µ–Ω —à—ã“ì–∞—Ä—ã–ª“ì–∞–Ω</option>
                            </select>
                        </form>
                        {% else %}
                        {% if equipment.status == '–ü–∞–π–¥–∞–ª–∞–Ω—É–¥–∞' %}
                        <span class="badge bg-success">üü¢ –ü–∞–π–¥–∞–ª–∞–Ω—É–¥–∞</span>
                        {% elif equipment.status == '–ñ”©–Ω–¥–µ—É–¥–µ' %}
                        <span class="badge bg-danger">üî¥ –ñ”©–Ω–¥–µ—É–¥–µ</span>
                        {% elif equipment.status == '–¢—ñ–∑—ñ–º–Ω–µ–Ω —à—ã“ì–∞—Ä—ã–ª“ì–∞–Ω' %}
                        <span class="badge bg-secondary">‚ö™ –¢—ñ–∑—ñ–º–Ω–µ–Ω —à—ã“ì–∞—Ä—ã–ª“ì–∞–Ω</span>
                        {% endif %}
                        {% endif %}
                    </td>
                    <td>{{ equipment.location }}</td>
                    <td>{{ equipment.inventory_number }}</td>
                    <td>{{ equipment.activation_date }}</td>
                    <td>
                        {% if equipment.files %}
                        <ul class="list-unstyled">
                            {% for file in equipment.files %}
                            <li>
                                <a href="{{ url_for('static', filename='uploads/' ~ file) }}" target="_blank" class="badge bg-secondary">{{ file }}</a>
                            </li>
                            {% endfor %}
                        </ul>
                        {% else %}
                        <span class="text-muted">–§–∞–π–ª–¥–∞—Ä –∂–æ“õ</span>
                        {% endif %}
                    </td>
                    <td>
                        <a href="{{ url_for('equipment_bp.generate_qr', id=equipment.id) }}" class="btn btn-outline-secondary btn-sm">QR –ö–æ–¥</a>
                    </td>
                    <td>
                        <button class="btn btn-link" type="button" data-bs-toggle="collapse" data-bs-target="#logs-{{ equipment.id }}" aria-expanded="false" aria-controls="logs-{{ equipment.id }}">
                            –¢–∞—Ä–∏—Ö—Ç—ã –∫”©—Ä—Å–µ—Ç—É
                        </button>
                        <div class="collapse" id="logs-{{ equipment.id }}">
                            <ul class="mt-2">
                                {% for log in equipment.logs %}
                                <li>{{ log.timestamp }}: {{ log.event }}</li>
                                {% endfor %}
                            </ul>
                        </div>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>

<style>
    .status-dropdown {
        width: auto;
        display: inline-block;
        padding: 0.25rem 0.5rem;
        font-size: 0.875rem;
        line-height: 1.5;
        border-radius: 0.25rem;
        border: 1px solid #ced4da;
        background-color: #f8f9fa;
        color: #495057;
    }

    .status-dropdown:focus {
        border-color: #80bdff;
        outline: 0;
        box-shadow: 0 0 0 0.2rem rgba(0, 123, 255, 0.25);
    }

    .status-dropdown option {
        padding: 0.5rem;
    }
</style>
{% endblock %}